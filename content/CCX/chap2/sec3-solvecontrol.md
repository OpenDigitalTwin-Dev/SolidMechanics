# 求解

关键字：

- `*CONTROLS`

此选项用于修改迭代控制参数，仅建议那些了解其含义并且在该领域有专业知识的用户使用

有两个互斥的子关键字

- `RESET`：重置控制参数为默认值

```
*CONTROLS, RESET
```

- `PARAMETERS`：用于更改默认设置，可选参数控制如下

| 参数选项            | 控制范围                     |
|-------------------|------------------------------|
| `TIME INCREMENTATION` | 增量迭代控制                     |
| `FIELD`             | 收敛准则                     |
| `LINE SEARCH`       | 线搜索参数（仅用于面-面接触罚方法） |
| `NETWORK`           | 网络迭代的收敛准则           |
| `CFD`               | 流体计算                     |
| `CONTACT`           | 面-面接触罚方法收敛准则              |

```
*CONTROLS, PARAMETERS = TIME INCREMENTATION
......
```

参考示例：

- [Wire Bending](../chap6/sec2-wirebending.md)

## TIME INCREMENTATION

在非线性有限元分析中，求解器在每个时间步的求解中，通常采用增量-迭代法（Newton-Raphon）。`TIME INCREMENTATION` 相关参数控制着每个时间步内的迭代行为，以及遇到发散或收敛缓慢时自动调整时间步长的策略。这些参数直接影响分析的稳定性、收敛速度和计算效率

子关键字分为两行，**第一行与时间步内迭代次数相关**

| 参数   | 作用及意义| 默认值 | 典型调整议 |
|:--------:|:-----------:|:-----------:|:-------:|
|$I_{0}$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | 检查残差连续增加的次数，若超过 $I_{0}$，则当前时间步长乘以 $D_{f}$ <br>**防止解持续发散，及时缩小时间步长提高收敛性** | $4$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 若模型易发散，可适当减小               |
| $I_{R}$     | 每隔 $I_{R}$ 次迭代进行一次对数收敛速率检查，预测当迭代次数为 $I_{C}$ 时是否能够收敛，若不能，当前时间步长乘以 $D_{C}$ <br>**防止解长时间缓慢收敛，及时调整时间步长**  | $8$  | 若模型收敛慢，可适当增大               |
| $I_{P}$     | 从第 $I_{P}$ 次迭代起，残差收敛判据由 $R_{n}^{\alpha}$ 切换为 $R_{p}^{\alpha}$（更宽松）<br>**允许初始阶段使用严格标准，后期切换为宽松标准，加快收敛**  | $9$      | 一般无需更改                           |
| $I_{C}$     | 当前时间步允许的最大迭代次数，若超过则强制缩小时间步长重试<br>**防止无休止迭代浪费计算资源** | $16$  | 对于极难收敛问题可适当增大             |
| $I_{L}$     | 若当前时间步内的迭代次数超过 $I_{L}$，则下一个时间步长乘以 $D_{B}$ <br>**当发现收敛困难时自动减小步长，增加稳定性**  | $10$  | 对于大变形/非线性强问题可适当减小      |
| $I_{G}$     | 若连续两个时间步的迭代次数都小于 $I_{G}$，下一个时间步长乘以 $D_{D}$<br>**若解收敛非常容易，自动加快分析进度**  |  $4$  | 若追求快速分析可适当减小               |
| $I_{S}$     | 当前未使用  | -   |  - |
| $I_{A}$     | 当前时间步允许的最大时间步长减小次数，若超过则报错终止<br>**防止无限制重试导致死循环**                                                        | 5      | 建议默认即可                           |
| $I_{J}$  | 当前未使用  | -  | -  |
| $I_{T}$  | 当前未使用  | -  | -  |

**第二行与时间步长的缩放因子相关**

| 参数   | 作用及意义| 默认值 | 典型调整议 |
|:--------:|:-----------:|:-----------:|:-------:|
|$D_{f}$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | 残差连续增加超过 $I_{0}$ 次时，当前时间步长乘以 $D_{f}$ <br>**强制减小时间步长以便恢复收敛** | $0.25$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 若模型极不稳定可减小至 $0.1\sim0.2$ |
| $D_{C}$     | 对数检查不通过时（$I_{R}$），当前时间步长乘以 $D_{C}$ <br>**解决收敛速度过慢问题**  | $0.5$ | 一般无需更改  |
| $D_{B}$     | 当前时间步迭代次数超过 $I_{L}$ 时，下一时间步长乘以 $D_{B}$ <br>**根据上一步的收敛表现动态调整步长**  | $0.75$ | 若希望更保守可减小  |
| $D_{A}$     | 若连续两个时间步的温度变化超过 `DELTMX`，下一时间步长乘以 $D_{A}$ <br>**用于热-结构耦合，防止温度突变导致收敛失败**  | $0.85$ | 热分析时可适当减小  |
| $D_{S}$  | 当前未使用  | -  | -  |
| $D_{H}$  | 当前未使用  | -  | -  |
| $D_{D}$  | 若连续两个时间步迭代次数都小于 $I_{G}$，下一个时间步长乘以 $D_{D}$ <br>**自动加快分析速度**  | $1.5$ | 若对收敛有信心可增大至 $2$  |
| $W_{G}$  | 当前未使用  | -  | -  |

## FIELD

在非线性有限元分析中，场变量（如温度、浓度、电势等）的求解通常采用增量-迭代法（如 Newton-Raphson 方法）。`FIELD` 参数用于控制场变量在每个时间步内的收敛判据和迭代策略。合理设置这些参数，有助于保证收敛准确性、提升求解效率和分析稳定性，在强非线性、多场耦合或极端工况下尤为重要

```{margin}

瞬时力：当前增量所有单元内节点力分量绝对值的平均值

平均力：当前时间步内所有增量的瞬时力的平均值，反映了该步内结构整体的不平衡程度。第一步迭代不作为参照；平均力会随着收敛趋于稳定
```

| 参数   | 作用及意义| 默认值 | 典型调整议 |
|:--------:|:-----------:|:-----------:|:-------:|
|$R_{n}^{\alpha}$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | 最大残差与平均力之比，衡量场变量（如温度、浓度）是否收敛到平衡状态 <br>**主要残差收敛判据** | $0.005$ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 若收敛困难可适当放宽（如 $0.01$）；对精度要求高可收紧（如 $0.001$）。适合大多数热/扩散/场耦合问题 |
|$C_{n}^{\alpha}$ | 解的最大相对修正量 <br>**最大解增量收敛判据** | $0.01$| 若解变化剧烈可放宽（如 $0.02$）；若需更严格收敛可收紧（如 $0.005$），通常与 $R_{n}^{\alpha}$ 配合使用 |
|$q_{0}^{\alpha}$| 初始（第一个时间步）平均力，用于归一化残差 | 上步值或 $0.01$| 通常无需调整。若第一步物理量极小或极大时，可手动设置以改善归一化效果 |
|$q_{u}^{\alpha}$| 用户自定义的平均力 | - | 若设置，平均力不再自动计算，直接采用此值。适用于特殊归一化需求，比如某些物理量非常小或非常大时 |
|$R_{p}^{\alpha}$| 若牛顿迭代次数达到 $I_{P}$ 后仍未收敛，收敛标准从 $R_{n}^{\alpha}$ 切换为 $R_{p}^{\alpha}$ <br>**备用残差收敛判据** | $0.02$ | 若遇到局部极难收敛问题可适当放宽；如需严格控制收敛质量可收紧 |
|$\epsilon^{\alpha}$| 判断系统是否已“无流动/无通量”（如热流为0），常用于稳态场问题 <br>**零通量判据** | $10^{-5}$ | 若稳态判定太敏感可放宽；如需极严格稳态判定可收紧 |
|$C_{\epsilon}^{\alpha}$| 解的最大相对修正量 <br>**零通量下最大解增量判据** | $10^{-3}$ | 若解变量波动大可适当放宽；如需极严格稳态判定可收紧 |
|$R_{l}^{\alpha}$| 目前看和 $R_{n}^{\alpha}$ 似乎没有区别 | $10^{-8}$ | 通常不需修改 |